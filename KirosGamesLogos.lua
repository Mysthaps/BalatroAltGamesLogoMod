----------------------------------------------
------------MOD CODE -------------------------

KGL = SMODS.current_mod

sendDebugMessage("Launching Kiro's Game Logos Mod!", "KirosGameLogoMod")


SMODS.Atlas {key = "modicon",	path = "icon.png",	px = 32, py = 32}

KGL.logos ={
    {name = "Library of Ruina",
        file = "balatro.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("edd9b2"),
        secondaryColour = HEX("bfb8aa"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("362d28"),
        buttons_colour = HEX("362d28"),
        play_text = HEX("ba9350"),
        buttons_text = HEX("ba9350"),
        menu_colour = HEX("242221")},

    {name = "Limbus Company",
        file = "balatro2.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("6b0707"),
        secondaryColour = HEX("2e0b0b"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("ccbdb1"),
        buttons_colour = HEX("ccbdb1"),
        play_text = HEX("3d3834"),
        buttons_text = HEX("3d3834"),
        menu_colour = HEX("664933")},

    {name = "Lobotomy Corporation",
        file = "balatro3.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("dbd38a"),
        secondaryColour = HEX("b01510"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("141414"),
        buttons_colour = HEX("141414"),
        play_text = HEX("ff0000"),
        buttons_text = HEX("ebeb96"),
        menu_colour = HEX("ff0000")},

    {name = "Leviathan",
        file = "balatro4.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("661106"),
        secondaryColour = HEX("242e1d"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("c9c9c9"),
        buttons_colour = HEX("3d543b"),
        play_text = HEX("b02323"),
        buttons_text = HEX("303030"),
        menu_colour = G.C.CLEAR},

    {name = "Half Life 1",
        file = "balatro5.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("994c0e"),
        secondaryColour = HEX("402b1a"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("666669"),
        buttons_colour = HEX("666669"),
        play_text = HEX("c9a128"),
        buttons_text = HEX("876e23"),
        menu_colour = HEX("414142")},

    {name = "Final Fantasy XIV: Shadowbringers",
        file = "balatro6.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("e8bf7d"),
        secondaryColour = HEX("431b69"),
        contrast = 2,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("36323d"),
        buttons_colour = HEX("36323d"),
        play_text = HEX("cc9650"),
        buttons_text = HEX("cc9650"),
        menu_colour = HEX("1a191c")},

    {name = "Z.A.T.O. I Love the World and Everything In It",
        file = "balatro7.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("362f27"),
        secondaryColour = HEX("523741"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("1c1c1c"),
        buttons_colour = HEX("1c1c1c"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("592136")},

    {name = "Barotrauma",
        file = "balatro8.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("212124"),
        secondaryColour = HEX("30060e"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("ab8644"),
        buttons_colour = HEX("242423"),
        play_text = HEX("2e2e2d"),
        buttons_text = HEX("d4c5ab"),
        menu_colour = HEX("363534")},

    {name = "Yakuza",
        file = "balatro9.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("918e8f"),
        secondaryColour = HEX("636363"),
        contrast = 2,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("3b3b3b"),
        buttons_colour = HEX("3b3b3b"),
        play_text = HEX("b51919"),
        buttons_text = HEX("a6a294"),
        menu_colour = HEX("242323")},

    {name = "Kirby Triple Deluxe",
        file = "balatro10.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("e35dcd"),
        secondaryColour = HEX("a3125b"),
        contrast = 3,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("d4792a"),
        buttons_colour = HEX("d4792a"),
        play_text = HEX("ebdacc"),
        buttons_text = HEX("ebdacc"),
        menu_colour = HEX("98c5d6")},

    {name = "Dispatch",
        file = "balatro11.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("3f998e"),
        secondaryColour = HEX("284a46"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("b09e80"),
        buttons_colour = HEX("706655"),
        play_text = HEX("2e2e2e"),
        buttons_text = HEX("2e2e2e"),
        menu_colour = HEX("cccccc")},

    {name = "The Wolf Among Us",
        file = "balatro12.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("491a66"),
        secondaryColour = HEX("a519b5"),
        contrast = 2,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("6e1a2f"),
        buttons_colour = HEX("6e1a2f"),
        play_text = HEX("f2e6e9"),
        buttons_text = HEX("ba2065"),
        menu_colour = HEX("571c41")},

    {name = "Pikmin",
        file = "balatro13.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("5ed17b"),
        secondaryColour = HEX("e0eb98"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("6ab564"),
        buttons_colour = HEX("3f7a3b"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("cccccc")},

    {name = "Halo",
        file = "balatro14.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("1a4f2d"),
        secondaryColour = HEX("b57e26"),
        contrast = 2,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("4d6b87"),
        buttons_colour = HEX("3d5266"),
        play_text = HEX("cccce0"),
        buttons_text = HEX("737373"),
        menu_colour = HEX("212a33")},

    {name = "Undertale",
        file = "balatro15.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("1c1c1c"),
        secondaryColour = HEX("1c1c1c"),
        contrast = 2,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("1c1c1c"),
        buttons_colour = HEX("1c1c1c"),
        play_text = HEX("d9c216"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("cccccc")},

    {name = "Garrys Mod",
        file = "balatro16.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("81c3d4"),
        secondaryColour = HEX("81c3d4"),
        contrast = 2,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("369fbf"),
        buttons_colour = HEX("828282"),
        play_text = HEX("ffffff"),
        buttons_text = HEX("ffffff"),
        menu_colour = HEX("595959")},

    {name = "Silent Hill",
        file = "balatro17.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("d1d1d1"),
        secondaryColour = HEX("666464"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("374f9e"),
        buttons_colour = HEX("1a1a1a"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = G.C.CLEAR},

    {name = "Judgement",
        file = "balatro18.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("454545"),
        secondaryColour = HEX("171717"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("a8b4b5"),
        buttons_colour = HEX("242424"),
        play_text = HEX("242424"),
        buttons_text = HEX("a8b4b5"),
        menu_colour = G.C.CLEAR},

    {name = "Jet Set Radio",
        file = "balatro19.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("e3dd3d"),
        secondaryColour = HEX("e36905"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("375c32"),
        buttons_colour = HEX("375c32"),
        play_text = HEX("d69c27"),
        buttons_text = HEX("d69c27"),
        menu_colour = HEX("739166")},

    {name = "Resident Evil - Original Trilogy",
        file = "balatro20.png",
        X = 255,
        Y = 100,
        credits = "Kiro",
        primaryColour = HEX("33201a"),
        secondaryColour = HEX("4a0c06"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("222eb3"),
        buttons_colour = HEX("222eb3"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("737373")},

    {name = "Catherine",
        file = "balatro21.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("e346c1"),
        secondaryColour = HEX("eb83d4"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("d6d6d6"),
        buttons_colour = HEX("d6d6d6"),
        play_text = HEX("6e132b"),
        buttons_text = HEX("242424"),
        menu_colour = HEX("6e132b")},

    {name = "Deltarune",
        file = "balatro22.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("1c1c1c"),
        secondaryColour = HEX("20aafa"),
        contrast = 3,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("1c1c1c"),
        buttons_colour = HEX("1c1c1c"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("e0e0e0")},

    {name = "DOOM",
        file = "balatro23.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("8c2306"),
        secondaryColour = HEX("d15524"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("292929"),
        buttons_colour = HEX("292929"),
        play_text = HEX("850909"),
        buttons_text = HEX("850909"),
        menu_colour = G.C.CLEAR},

    {name = "Minecraft",
        file = "balatro24.png",
        X = 272,
        Y = 55,
        credits = "Kiro",
        primaryColour = HEX("11d144"),
        secondaryColour = HEX("0a6e24"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("6e6e6e"),
        buttons_colour = HEX("6e6e6e"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("3d2c22")},

    {name = "Left 4 Dead",
        file = "balatro25.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("05540a"),
        secondaryColour = HEX("068c0e"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("732222"),
        buttons_colour = HEX("525151"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("141414")},

    {name = "Cyberpunk 2077",
        file = "balatro26.png",
        X = 283,
        Y = 77,
        credits = "Kiro",
        primaryColour = HEX("4f453d"),
        secondaryColour = HEX("36b8cf"),
        contrast = 3,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("7a1c1c"),
        buttons_colour = HEX("302220"),
        play_text = HEX("34a2ba"),
        buttons_text = HEX("34a2ba"),
        menu_colour = HEX("b53221")},

    {name = "Terraria",
        file = "balatro27.png",
        X = 220,
        Y = 71,
        credits = "Kiro",
        primaryColour = HEX("1d96e0"),
        secondaryColour = HEX("6338c7"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("6254d1"),
        buttons_colour = HEX("6254d1"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("cccccc")},

    {name = "Super Balatro",
        file = "balatro28.png",
        X = 176,
        Y = 88,
        credits = "UltraEpicLeader100",
        primaryColour = HEX("8a83cc"),
        secondaryColour = HEX("8a83cc"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("d6bbb2"),
        buttons_colour = HEX("d6bbb2"),
        play_text = HEX("292929"),
        buttons_text = HEX("292929"),
        menu_colour = HEX("804522")},

    {name = "Sonic The Hedgehog",
        file = "balatro29.png",
        X = 227,
        Y = 42,
        credits = "UltraEpicLeader100",
        primaryColour = HEX("0e49a1"),
        secondaryColour = HEX("ba040d"),
        contrast = 3,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("d10808"),
        buttons_colour = HEX("d10808"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("2634ad")},

    {name = "Gradius",
        file = "balatro30.png",
        X = 274,
        Y = 44,
        credits = "UltraEpicLeader100",
        primaryColour = HEX("000000"),
        secondaryColour = HEX("000000"),
        contrast = 1,
        creditsColour = HEX("2f74ba"),
        play_colour = HEX("000000"),
        buttons_colour = HEX("000000"),
        play_text = HEX("2f74ba"),
        buttons_text = HEX("2f74ba"),
        menu_colour = HEX("000000")},

    {name = "Persona 5",
        file = "balatro31.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("e60000"),
        secondaryColour = HEX("000000"),
        contrast = 3,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("1a1a1a"),
        buttons_colour = HEX("1a1a1a"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("de0000")},

    {name = "Omori",
        file = "balatro32.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("f0ebeb"),
        secondaryColour = HEX("f0ebeb"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("292929"),
        buttons_colour = HEX("292929"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("cccccc")},

    {name = "Oxenfree",
        file = "balatro33.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("1d382e"),
        secondaryColour = HEX("1a211e"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("731c36"),
        buttons_colour = HEX("731c36"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("616161")},

    {name = "Phoenix Wright: Ace Attorney",
        file = "balatro34.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("124d99"),
        secondaryColour = HEX("8a0f40"),
        contrast = 2,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("6b9edb"),
        buttons_colour = HEX("6b9edb"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = G.C.CLEAR},

    {name = "Resident Evil - Modern REmakes",
        file = "balatro35.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("27404f"),
        secondaryColour = HEX("363b3d"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("575757"),
        buttons_colour = HEX("575757"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("292929")},

    {name = "Clair Obscur: Expedition 33",
        file = "balatro36.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("382828"),
        secondaryColour = HEX("261c1c"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("9e7f54"),
        buttons_colour = HEX("4d4843"),
        play_text = HEX("38332c"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = G.C.CLEAR},

    {name = "Guilty Gear Xrd REV2",
        file = "balatro37.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("488752"),
        secondaryColour = HEX("1b361f"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("58b883"),
        buttons_colour = HEX("58b883"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("616161")},

    {name = "Transistor",
        file = "balatro38.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("1d3d35"),
        secondaryColour = HEX("0e1211"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("222e2b"),
        buttons_colour = HEX("222e2b"),
        play_text = HEX("d4d4d4"),
        buttons_text = HEX("d4d4d4"),
        menu_colour = HEX("228574")},

    {name = "Milk Inside a Bag Of Milk Inside a Bag of Milk",
        file = "balatro39.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("000000"),
        secondaryColour = HEX("000000"),
        contrast = 1,
        creditsColour = HEX("7c128c"),
        play_colour = HEX("7c128c"),
        buttons_colour = HEX("7c128c"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("000000")},

    {name = "Milk Outside a Bag Of Milk Outside a Bag of Milk",
        file = "balatro40.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("3d1919"),
        secondaryColour = HEX("0a0a0a"),
        contrast = 1,
        creditsColour = HEX("a32441"),
        play_colour = HEX("a32441"),
        buttons_colour = HEX("a32441"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("e0e0e0"),
        menu_colour = HEX("262525")},
    
    {name = "Hitman",
        file = "balatro41.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("4f0a1a"),
        secondaryColour = HEX("42282e"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("bd0606"),
        buttons_colour = HEX("e6e6e6"),
        play_text = HEX("e0e0e0"),
        buttons_text = HEX("363636"),
        menu_colour = G.C.CLEAR},

    {name = "Hades",
        file = "balatro42.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("184a34"),
        secondaryColour = HEX("151a17"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("524545"),
        buttons_colour = HEX("524545"),
        play_text = HEX("b0abab"),
        buttons_text = HEX("b0abab"),
        menu_colour = HEX("99120b")},

    {name = "The Binding of Isaac",
        file = "balatro43.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("b09b80"),
        secondaryColour = HEX("1c1a1a"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("bdb2a6"),
        buttons_colour = HEX("bdb2a6"),
        play_text = HEX("3b3630"),
        buttons_text = HEX("3b3630"),
        menu_colour = HEX("787169")},

    {name = "Ball X Pit",
        file = "balatro44.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("4f0a1a"),
        secondaryColour = HEX("42282e"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("402a2a"),
        buttons_colour = HEX("402a2a"),
        play_text = HEX("c49595"),
        buttons_text = HEX("c49595"),
        menu_colour = HEX("c99a61")},

    {name = "Signalis",
        file = "balatro45.png",
        X = 333,
        Y = 216,
        credits = "Kiro",
        primaryColour = HEX("363433"),
        secondaryColour = HEX("363433"),
        contrast = 1,
        creditsColour = HEX("e0e0e0"),
        play_colour = HEX("e0e0e0"),
        buttons_colour = HEX("d94141"),
        play_text = HEX("292626"),
        buttons_text = HEX("292626"),
        menu_colour = G.C.CLEAR},
    {name = "Rhythm Heaven",
        file = "balatroheaven",
        X = 333,
        Y = 216,
        credits = "King",
        primaryColour = HEX("faa61a"),
        secondaryColour = HEX("faa61a"),
        contrast = 1,
        creditsColour = HEX("ffffff"),
        play_colour = HEX("130c0e"),
        buttons_colour = HEX("130c0e"),
        play_text = HEX("f15a22"),
        buttons_text = HEX("faa61a"),
        multipart_pulse = true},
}



--------------------
-- Config Options --
--------------------
---

function G.FUNCS.selected_main_logo(arg)
    KGL.config.selected_logo = arg.to_key
    SMODS.save_mod_config(KGL)
end


   local ordered_names, viewed_logo = {}, 1
  for k, v in ipairs(KGL.logos) do
    ordered_names[#ordered_names+1] = v.name
--    if v.name == G.GAME.viewed_back.name then viewed_logo = k end
  end

KGL.config_tab = function()
    return {n=G.UIT.ROOT, config = {align = "cm", padding = 0.05, colour = G.C.CLEAR}, nodes={
        create_toggle({label = "Enable fixed logo (requires restart)", ref_table = KGL.config, ref_value = "enable_fixed_logo"}),
        create_option_cycle({
                align = "cm",
                ref_table = KGL.config,
                ref_value = "selected_logo",
                current_option = KGL.config.selected_logo,
                opt_callback = "selected_main_logo",
                w = 10,
                label = "Selected Logo",
                options = ordered_names,
            }),
    }}
end

local selectedMenu = math.random(1,45)

local selectedMenuFixed = KGL.config.selected_logo or 1

KGL.selected_logo = {name = "AAAA", credits = "AAAA", primaryColour = "AAAA", secondaryColour = "AAAA", contrast = "AAAA", creditsColour = "AAAA"}


--SMODS.Atlas{key = "balatro", path = possibleMainMenus[selectedMenu], px = possibleX[selectedMenu], py = possibleY[selectedMenu], prefix_config = { key = false }, artCredits = artCredits[selectedMenu], colourMain = primaryColour[selectedMenu], colourSecondary = secondaryColour[selectedMenu], colourCredits = creditsColour[selectedMenu]}

if KGL.config.enable_fixed_logo == false then
    KGL.selected_logo.name = KGL.logos[selectedMenu].name
    KGL.selected_logo.file = KGL.logos[selectedMenu].file
    KGL.selected_logo.X = KGL.logos[selectedMenu].X
    KGL.selected_logo.Y = KGL.logos[selectedMenu].Y
    KGL.selected_logo.credits = KGL.logos[selectedMenu].credits
    KGL.selected_logo.primaryColour = KGL.logos[selectedMenu].primaryColour
    KGL.selected_logo.secondaryColour = KGL.logos[selectedMenu].secondaryColour
    KGL.selected_logo.contrast = KGL.logos[selectedMenu].contrast
    KGL.selected_logo.creditsColour = KGL.logos[selectedMenu].creditsColour
    KGL.selected_logo.play_colour = KGL.logos[selectedMenu].play_colour
    KGL.selected_logo.buttons_colour = KGL.logos[selectedMenu].buttons_colour
    KGL.selected_logo.play_text = KGL.logos[selectedMenu].play_text
    KGL.selected_logo.buttons_text = KGL.logos[selectedMenu].buttons_text
    KGL.selected_logo.menu_colour = KGL.logos[selectedMenu].menu_colour
    KGL.selected_logo.multipart_pulse = KGL.logos[selectedMenu].multipart_pulse
else
    KGL.selected_logo.name = KGL.logos[selectedMenuFixed].name
    KGL.selected_logo.file = KGL.logos[selectedMenuFixed].file
    KGL.selected_logo.X = KGL.logos[selectedMenuFixed].X
    KGL.selected_logo.Y = KGL.logos[selectedMenuFixed].Y
    KGL.selected_logo.credits = KGL.logos[selectedMenuFixed].credits
    KGL.selected_logo.primaryColour = KGL.logos[selectedMenuFixed].primaryColour
    KGL.selected_logo.secondaryColour = KGL.logos[selectedMenuFixed].secondaryColour
    KGL.selected_logo.contrast = KGL.logos[selectedMenuFixed].contrast
    KGL.selected_logo.creditsColour = KGL.logos[selectedMenuFixed].creditsColour
    KGL.selected_logo.play_colour = KGL.logos[selectedMenuFixed].play_colour
    KGL.selected_logo.buttons_colour = KGL.logos[selectedMenuFixed].buttons_colour
    KGL.selected_logo.play_text = KGL.logos[selectedMenuFixed].play_text
    KGL.selected_logo.buttons_text = KGL.logos[selectedMenuFixed].buttons_text
    KGL.selected_logo.menu_colour = KGL.logos[selectedMenuFixed].menu_colour
    KGL.selected_logo.multipart_pulse = KGL.logos[selectedMenuFixed].multipart_pulse
end

if not KGL.selected_logo.multipart_pulse then
    SMODS.Atlas{key = "balatro", path = KGL.selected_logo.file, px = KGL.selected_logo.X, py = KGL.selected_logo.Y, prefix_config = { key = false }}
else
    SMODS.Atlas{key = "balatro_bg", path = KGL.selected_logo.file.."/bg.png", px = KGL.selected_logo.X, py = KGL.selected_logo.Y, prefix_config = { key = false }}
    SMODS.Atlas{key = "balatro_text", path = KGL.selected_logo.file.."/text.png", px = KGL.selected_logo.X, py = KGL.selected_logo.Y, prefix_config = { key = false }}
end

--------------------
-- Music Syncing --
--------------------

KGL.conductor = {
    track = '',
    bpm = 105,
    offset = -0.01,
    sec_per_beat = 60 / (105/0.7), 
    beat = 0, 
    pitch = 0.7,
}

local sync_events = {
    {beat = 7, type = "b"},
    {beat = 7.5, type = "b"},
    {beat = 10.5, type = "b"},
    {beat = 10.75, type = "b"},
    {beat = 11, type = "b"},
    {beat = 11.5, type = "b"},
    {beat = 11.75, type = "b"},
    {beat = 12, type = "b"},
    {beat = 12.5, type = "b"},
    {beat = 12.75, type = "b"},
    {beat = 13, type = "b"},
    {beat = 13.5, type = "b"},
    {beat = 13.75, type = "b"},
    {beat = 14, type = "b"},
    {beat = 15.5, type = "b"},
    {beat = 16, type = "t"},
    {beat = 18.5, type = "b"},
    {beat = 19, type = "b"},
    {beat = 20, type = "b"},
    {beat = 21, type = "b"},
    {beat = 22.5, type = "b"},
    {beat = 23, type = "t"},
    {beat = 25.5, type = "b"},
    {beat = 26, type = "b"},
    {beat = 27, type = "t"},
    -- LOOP STARTS
    {beat = 28, type = "b"},
    {beat = 29.5, type = "b"},
    {beat = 30, type = "t"},
    {beat = 32.5, type = "b"},
    {beat = 33, type = "b"},
    {beat = 34, type = "b"},
    {beat = 34.5, type = "t", loop = {0}},
    {beat = 35, type = "b"},
    {beat = 36.5, type = "b"},
    {beat = 37, type = "t"},
    {beat = 39, type = "t", loop = {0}},
    {beat = 39.5, type = "b"},
    {beat = 40, type = "b"},
    {beat = 41, type = "t"},
    {beat = 42, type = "b"},
    {beat = 43.5, type = "b"},
    {beat = 44, type = "t"},
    {beat = 46.5, type = "b"},
    {beat = 47, type = "b"},
    {beat = 48, type = "b"},
    {beat = 49, type = "b"},
    {beat = 50.5, type = "b"},
    {beat = 51, type = "t"},
    {beat = 53.5, type = "b"},
    {beat = 54, type = "b"},
    {beat = 55, type = "t"},
    {beat = 56, type = "b"},
    {beat = 57.5, type = "b"},
    {beat = 58, type = "t"},
    {beat = 60.5, type = "b"},
    {beat = 61, type = "b"},
    {beat = 62, type = "b"},
    {beat = 63, type = "b"},
    {beat = 64.5, type = "b"},
    {beat = 65, type = "t"},
    {beat = 67.5, type = "b"},
    {beat = 68, type = "b"},
    {beat = 69, type = "t"},
    {beat = 70, type = "b"},
    {beat = 71.5, type = "b"},
    {beat = 72, type = "t"},
    {beat = 74.5, type = "b"},
    {beat = 75, type = "b"},
    {beat = 76, type = "b"},
    {beat = 77, type = "b"},
    {beat = 78.5, type = "b"},
    {beat = 79, type = "t"},
    {beat = 81.5, type = "b"},
    {beat = 82, type = "b"},
    {beat = 83, type = "t"},
    {beat = 84, type = "b"},
    {beat = 85.5, type = "b"},
    {beat = 86, type = "t"},
    {beat = 88.5, type = "b"},
    {beat = 89, type = "b"},
    {beat = 90, type = "b"},
    {beat = 90.5, type = "t", loop = {0}},
    {beat = 91, type = "b"},
    {beat = 92.5, type = "b"},
    {beat = 93, type = "t"},
    {beat = 95, type = "t", loop = {0, 2}},
    {beat = 95.5, type = "b"},
    {beat = 96, type = "b"},
    {beat = 97, type = "t"},
    {beat = 98, type = "b"},
    {beat = 99.5, type = "b"},
    {beat = 100, type = "t"},
    {beat = 102.5, type = "b"},
    {beat = 103, type = "b"},
    {beat = 104, type = "b"},
    {beat = 105, type = "b"},
    {beat = 106.5, type = "b"},
    {beat = 107, type = "t"},
    {beat = 109.5, type = "b"},
    {beat = 110, type = "b"},
    {beat = 111, type = "t"},
    {beat = 112, type = "b"},
    {beat = 113.5, type = "b"},
    {beat = 114, type = "t"},
    {beat = 116.5, type = "b"},
    {beat = 117, type = "b"},
    {beat = 118, type = "b"},
    {beat = 119, type = "b"},
    {beat = 120.5, type = "b"},
    {beat = 121, type = "t"},
    {beat = 123.5, type = "b"},
    {beat = 124, type = "t", loop = {0}},
    {beat = 125, type = "t"},
    {beat = 126, type = "b"},
    {beat = 127.5, type = "b"},
    {beat = 128, type = "t"},
    {beat = 130.5, type = "b"},
    {beat = 131, type = "b"},
    {beat = 132, type = "b"},
    {beat = 133, type = "b"},
    {beat = 134.5, type = "b"},
    {beat = 135, type = "t"},
    {beat = 137.5, type = "b"},
    {beat = 138, type = "b"},
    {beat = 139, type = "t"},
    {beat = 140, type = "b"},
    {beat = 141.5, type = "b"},
    {beat = 142, type = "t"},
    {beat = 144.5, type = "b"},
    {beat = 145, type = "b"},
    {beat = 146, type = "b"},
    {beat = 146.5, type = "t", loop = {0, 2}},
    {beat = 147, type = "b"},
    {beat = 148.5, type = "b"},
    {beat = 149, type = "t"},
    {beat = 151, type = "t", loop = {0, 2}},
    {beat = 151.5, type = "b"},
    {beat = 152, type = "b"},
    {beat = 153, type = "t"},
    -- END LOOP
    {beat = 375.75, type = "t"},
    {beat = 376.5, type = "t"},
}

-- Updates the conductor when sound changes
local modulate_soundref = modulate_sound
function modulate_sound(dt)
    local prev_track = SMODS.previous_track
    modulate_soundref(dt)
    local cur_track = SMODS.previous_track
    if prev_track ~= cur_track then
        KGL.conductor.track = cur_track
        KGL.conductor.beat = 0
    end
end

local last_beat = 0
function KGL.condupd(dt)
    -- Only activate for music1
    
    if KGL.conductor.track == 'music1' then
        local beat = KGL.conductor.beat
        G.SOUND_MANAGER.channel:push({type = "get_kgl_conductor"})
        while G.SOUND_MANAGER.conductor:getCount() > 0 do
            req = G.SOUND_MANAGER.conductor:pop()
        end
        if not req then return end

        if beat - last_beat > KGL.conductor.sec_per_beat then -- bandage fix
            if math.abs(beat - last_beat) < 100 then
                G.ARGS.push = G.ARGS.push or {}
                G.ARGS.push.type = 'restart_music'
                if G.F_SOUND_THREAD then
                    G.SOUND_MANAGER.channel:push(G.ARGS.push)
                else
                    RESTART_MUSIC(G.ARGS.push)
                end
            end
        elseif beat ~= last_beat then
            for _, v in ipairs(sync_events) do
                local can = false
                if v.beat < 14 or v.beat > 153 then 
                    if v.beat > last_beat and v.beat <= beat then print(v.beat); can = true
                    end
                else 
                    for i = 0, 2 do
                        local found = true
                        if v.loop then
                            found = false
                            for _, vv in ipairs(v.loop) do if vv == i then found = true; break; end end
                        end
                        if found then
                            if v.beat + 140 * i > beat then break;
                            elseif v.beat + 140 * i > last_beat then print(v.beat); can = true; break;
                            end
                        end
                    end
                end
                if can then
                    local element = (((v.loop_flip and v.type == "t") or v.type == "b") and G.SPLASH_LOGO or G.SPLASH_LOGO_TEXT)
                    local old_scale = {x = KGL.selected_logo.X, y = KGL.selected_logo.Y}
                    element.scale = {x = element.scale.x * 0.97, y = element.scale.y * 0.97}
                    G.E_MANAGER:add_event(Event({
                        trigger = 'ease',
                        blockable = false,
                        blocking = false,
                        ref_table = element.scale,
                        ref_value = "x",
                        ease_to = old_scale.x,
                        delay = 0.1,
                        timer = "REAL"
                    }))
                    G.E_MANAGER:add_event(Event({
                        trigger = 'ease',
                        blockable = false,
                        blocking = false,
                        ref_table = element.scale,
                        ref_value = "y",
                        ease_to = old_scale.y,
                        delay = 0.1,
                        timer = "REAL"
                    }))
                end
            end
        end

        local pos = req.pos - KGL.conductor.offset
        last_beat = KGL.conductor.beat
        KGL.conductor.beat = pos / KGL.conductor.sec_per_beat
    end
end

